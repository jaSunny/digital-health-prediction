SET SCHEMA TUKGRP1;
DROP TYPE PAL_FLOGISTICR_PREDICT_T;
CREATE TYPE PAL_FLOGISTICR_PREDICT_T AS TABLE("ID" integer,
"FEATURE_GENDER" integer,
--"FEATURE_BIRTH_DATE" integer,
"FEATURE_BIRTH_YEAR" integer,
"FEATURE_AGE" integer,
"FEATURE_HEIGHT" integer,
"FEATURE_ZIP" integer,
"FEATURE_SMOKING_PACKS_A_DAY" integer,
"FEATURE_ACTIVITY_LEVEL" integer,
"FEATURE_BLOOD_TYPE" integer,
"FEATURE_AVG_SLEEP_TIME" integer,
"ROUND_AVG_SLEEP_TIME" integer,
"FEATURE_COMMUTING_DISTANCE" integer,
"FEATURE_DRINKS_ALCOHOL" integer,
"FEATURE_BMI" integer,
"FEATURE_SLEEP_BY_AGE" integer,
"FEATURE_ACTIVITY_LVL_COMMUTING_DIS_BY_AGE" integer,
"FEATURE_BMI_SMOKING_BY_AGE" integer,
"FEATURE_COMMUTING_DRUNK_AGE" integer,
--"FEATURE_SLEEP_POS_OFFSET_BY_AGE" integer,
"FEATURE_SLEEP_NEG_OFFSET_BY_AGE" integer,
"FEATURE_SLEEP_OFFSET_BY_AGE_FROM_MEAN" integer
--"FEATURE_LN_ACTIVITY_SLEEP_BMI" integer,
--"FEATURE_LN_ACTIVITY_SLEEP" integer,
);
DROP TYPE PAL_FLOGISTICR_COEFFICIENT_T;
CREATE TYPE PAL_FLOGISTICR_COEFFICIENT_T AS TABLE("ID" INTEGER, "PMMLMODEL" VARCHAR(5000));
DROP TYPE PAL_CONTROL_T;
CREATE TYPE PAL_CONTROL_T AS TABLE("NAME" VARCHAR(50), "INTARGS" INTEGER, "DOUBLEARGS" DOUBLE, "STRINGARGS" VARCHAR(100));
DROP TYPE PAL_FLOGISTICR_FITTED_T;
CREATE TYPE PAL_FLOGISTICR_FITTED_T AS TABLE("ID" NVARCHAR(255),"Fitted" DOUBLE,"TYPE" INTEGER);
DROP table PAL_FLOGISTICR_PDATA_TBL;
CREATE column table PAL_FLOGISTICR_PDATA_TBL("POSITION" INT, "SCHEMA_NAME" NVARCHAR(256), "TYPE_NAME" NVARCHAR(256), "PARAMETER_TYPE" VARCHAR(7));
INSERT INTO PAL_FLOGISTICR_PDATA_TBL VALUES (1,'TUKGRP1', 'PAL_FLOGISTICR_PREDICT_T','IN');
INSERT INTO PAL_FLOGISTICR_PDATA_TBL VALUES (2,'TUKGRP1', 'PAL_CONTROL_T','IN');
INSERT INTO PAL_FLOGISTICR_PDATA_TBL VALUES (3,'TUKGRP1', 'PAL_FLOGISTICR_COEFFICIENT_T','IN');
INSERT INTO PAL_FLOGISTICR_PDATA_TBL VALUES (4,'TUKGRP1', 'PAL_FLOGISTICR_FITTED_T','OUT');
CALL SYS.AFLLANG_WRAPPER_PROCEDURE_DROP('TUKGRP1', 'PAL_FORECASTWITHLOGISTICR_PROC');
CALL SYS.AFLLANG_WRAPPER_PROCEDURE_CREATE('AFLPAL','FORECASTWITHLOGISTICR', 'TUKGRP1', 'PAL_FORECASTWITHLOGISTICR_PROC', PAL_FLOGISTICR_PDATA_TBL);

DROP TABLE PAL_FLOGISTICR_PREDICTDATA_TBL;
CREATE COLUMN TABLE PAL_FLOGISTICR_PREDICTDATA_TBL LIKE PAL_FLOGISTICR_PREDICT_T;
INSERT INTO PAL_FLOGISTICR_PREDICTDATA_TBL (SELECT
"ID",
"FEATURE_GENDER",
--"FEATURE_BIRTH_DATE",
"FEATURE_BIRTH_YEAR",
"FEATURE_AGE" ,
"FEATURE_HEIGHT",
"FEATURE_ZIP",
"FEATURE_SMOKING_PACKS_A_DAY",
"FEATURE_ACTIVITY_LEVEL",
"FEATURE_BLOOD_TYPE",
"FEATURE_AVG_SLEEP_TIME",
"ROUND_AVG_SLEEP_TIME",
"FEATURE_COMMUTING_DISTANCE",
"FEATURE_DRINKS_ALCOHOL",
"FEATURE_BMI",
"FEATURE_SLEEP_BY_AGE",
"FEATURE_ACTIVITY_LVL_COMMUTING_DIS_BY_AGE",
"FEATURE_BMI_SMOKING_BY_AGE",
"FEATURE_COMMUTING_DRUNK_AGE",
--"FEATURE_SLEEP_POS_OFFSET_BY_AGE",
"FEATURE_SLEEP_NEG_OFFSET_BY_AGE",
"FEATURE_SLEEP_OFFSET_BY_AGE_FROM_MEAN"
--"FEATURE_LN_ACTIVITY_SLEEP_BMI",
--"FEATURE_LN_ACTIVITY_SLEEP",
   FROM TRAINING_FEATURES_UNCLASSIFIED);
DROP TABLE #PAL_CONTROL_TBL;
CREATE LOCAL TEMPORARY COLUMN TABLE #PAL_CONTROL_TBL ("NAME" VARCHAR(50), "INTARGS" INTEGER, "DOUBLEARGS" DOUBLE, "STRINGARGS" VARCHAR(100));
INSERT INTO #PAL_CONTROL_TBL VALUES ('THREAD_NUMBER',200,null,null);
--INSERT INTO #PAL_CONTROL_TBL VALUES ('CATEGORY_COL',1,null,null);
INSERT INTO #PAL_CONTROL_TBL VALUES ('MODEL_FORMAT',1,null,null);
DROP TABLE PAL_FLOGISTICR_COEEFICIENT_TBL;
CREATE COLUMN TABLE PAL_FLOGISTICR_COEEFICIENT_TBL LIKE PAL_FLOGISTICR_COEFFICIENT_T;
INSERT INTO PAL_FLOGISTICR_COEEFICIENT_TBL (SELECT * FROM PAL_LOGISTICR_PMMLMODEL_TBL);
DROP TABLE PAL_FLOGISTICR_FITTED_TBL;
CREATE COLUMN TABLE PAL_FLOGISTICR_FITTED_TBL LIKE PAL_FLOGISTICR_FITTED_T;
CALL TUKGRP1.PAL_FORECASTWITHLOGISTICR_PROC(PAL_FLOGISTICR_PREDICTDATA_TBL, "#PAL_CONTROL_TBL", PAL_FLOGISTICR_COEEFICIENT_TBL, PAL_FLOGISTICR_FITTED_TBL) WITH OVERVIEW;
SELECT * FROM PAL_FLOGISTICR_FITTED_TBL;
